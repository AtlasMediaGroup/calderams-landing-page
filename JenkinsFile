pipeline {
    agent any

    stages {

    stage("Gather Deployment Parameters") {
        steps {
            timeout(time: 30, unit: 'SECONDS') {
                script {
                    // Show the select input modal
                   def INPUT_PARAMS = input message: 'Please Provide Parameters', ok: 'Next',
                                    parameters: [
                                    choice(name: 'ARCHIVA_STORE', choices: ['Yes','No'].join('\n'), description: 'Would you like to save this build in Archiva?'),
                                    choice(name: 'ENVIRONMENT', choices: ['Sandbox','Development','QA','Demo','OPS'].join('\n'), description: 'Which environment would you like this build to be deployed to?')]
                    env.ARCHIVA_STORE = INPUT_PARAMS.ARCHIVA_STORE
                    env.ENVIRONMENT = INPUT_PARAMS.ENVIRONMENT
                }
            }
        }
    }
        stage('Checkout from SCM') {
            steps {
                checkout scm
            }
        }
        stage('Install Toolset') {
            steps {
                sh 'npm install react-scripts --force'
                sh 'npm install --force'
            }
        }
        stage('Run Test'){
        parallel {
            stage('Run Unit Tests') {
                steps {
                    sh 'npm t'
                }
                post {
                    always {
                      step([$class: 'CoberturaPublisher', coberturaReportFile: 'output/coverage/jest/cobertura-coverage.xml'])
                    }
                    }
            }
            stage('Run Mutation Tests') {
                steps {
                    echo 'Run all the mutation tests here please'
                }
            }
        }
        }
        stage('Store In Archiva') {
            steps {
                script{
                    if(env.ARCHIVA_STORE == 'Yes'){
                        echo 'This would be where you store in Archiva'
                    }else{
                        echo 'End of build because you are not storing in archiva'
                        currentBuild.result = 'SUCCESS'
                    }
                }
            }
        }


        stage('Build Branch') {
            steps {
                sh 'npm run jenkins-build'
            }
        }

        stage('Deployment') {
            steps {
                script{
                    if(env.ENVIRONMENT == 'Sandbox'){
                        echo 'Sandbox Deployment here'
                    }else if(env.ENVIRONMENT == 'Development'){
                        echo 'Development Deployment Here'
                    }else if(env.ENVIRONMENT == 'QA'){
                        echo 'QA Deployment Here'
                    }else if(env.ENVIRONMENT == 'Demo'){
                        echo 'Demo Deployment Here'
                    }else if(env.ENVIRONMENT == 'OPS'){
                        echo 'OPS Deployment Here'
                  }
                }
            }
        }


    }



}
